import { Head, Appear } from 'mdx-deck'
import { Invert, Split, SplitRight } from 'mdx-deck/layouts'

export { default as theme } from './theme'

<Head>
  <title>Babel ‚ù§Ô∏è GraphQL</title>
  <meta name='twitter:card' content='summary_large_image' />
  <meta name='twitter:site' content='@swyx' />
  <meta name='twitter:title' content='Babel <3 Graphql: An intro to babel-blade' />
  <meta name='twitter:description' content='Solving the double declaration problem in clientside GraphQL' />
  <meta name='twitter:image' content='https://babel-blade.netlify.com/slides/card.png' />
</Head>

# Babel ‚ù§Ô∏è GraphQL
### solving the double declaration problem

<div  style={{textAlign:"right"}}>
<small>Slides: <a href="https://swyx.io/ReactBoston">https://swyx.io/ReactBoston</a></small>
</div>

---

<div style={{textAlign: "center", fontSize: "150%", marginBottom: 20}}>
  <a href="https://JAMstackconf.com">https://JAMstackconf.com</a>
</div>

![https://pbs.twimg.com/card_img/1045017828074692610/zHRr5f1j?format=jpg&name=600x314](https://pbs.twimg.com/card_img/1045017828074692610/zHRr5f1j?format=jpg&name=600x314)

---

<div style={{textAlign: "center", fontSize: "150%", marginBottom: 20}}>
  <a href="https://reddit.com/r/reactjs">/r/reactjs</a>: 70,000+ React Devs
</div>

![https://pbs.twimg.com/media/DlvxTggU0AE_xbF.jpg](https://pbs.twimg.com/media/DlvxTggU0AE_xbF.jpg)

---

import { CodeSurfer } from "mdx-deck-code-surfer"
import ShadesOfPurple from "prism-react-renderer/themes/shadesOfPurple"

<CodeSurfer
  title="Double Declaration"
  theme={ShadesOfPurple}
  code={require("!raw-loader!./snippets/apollo-dog.js")}
  lang="javascript"
  showNumbers={false}
  dark={true}
  steps={[
    { lines: [2, 3, 5, 13] },
    { lines: [4, 17] },
  ]}
/>

---

## Metaprogramming

### New GraphQL Client with Proxies?

---

<CodeSurfer
  title="First attempt: React-Blade"
  theme={ShadesOfPurple}
  code={require("!raw-loader!./snippets/react-blade.js")}
  lang="javascript"
  showNumbers={false}
  dark={true}
  steps={[
    { lines: [2], tokens: {10: [4], 11: [7]} },
    { lines: [2, 3], tokens: {10: [4], 11: [7,9]} },
    { lines: [2, 3, 4], tokens: {10: [4], 11: [7,9,11]} },
    { range: [1, 15]}
  ]}
/>

---

## ~~Runtime Metaprogramming~~

### ~~New GraphQL Client with Proxies?~~

üí©

## AOT Metaprogramming

### AOT compilation for **ANY** GraphQL Client

üéâ

---

## Play with babel-blade ‚õ∏Ô∏è

- [Babel REPL](https://babeljs.io/repl#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=JYWwDg9gTgLgBAbwMIQHaoKYGMYBo4COArhlAJ4C-cAZlBCHAORFQEA2jAUJ1mgM7wwAQwDmGAIolycALxwsUDEJgSpZABQBKHv3gBBMGFlwtsgHwnOcOAB4U6bDCvXCamQmKkNwsZK-aKZ2ssAAtgNgATRVR3dQQ4COUhOApNc0QglzYMeEU-IjZ4OR9VL3VEmCFNAG5M62z4BCEcaD4qOTyCmAA6EAgAN2AMOrhFGBZUSxdp2wKzEembPRaoBKT3ZphW7vzDaBhgVBEqAHp5mZmllbXKjZW-buyhCMPjuDOF2xO5ke1rAEgKIFrB9NEA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=false&presets=&prettier=false&targets=&version=6.26.0&envVersion=)
- [ASTExplorer](https://latest.astexplorer.net/#/gist/01983f61e310f1eaf6b12a221556a937/213eda76de287dffef1fb899596e8c89262fa422)

export default Invert

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- Fields
- Operation Name
- Arguments
- Aliases
- Variables
- Directives
- Fragments

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- ‚úÖ Fields
- ‚úÖ Operation Name
- Arguments
- Aliases
- Variables
- Directives
- Fragments

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- ‚úÖ Fields
- ‚úÖ Operation Name
- ‚úÖ Arguments
- ‚úÖ Aliases
- Variables
- Directives
- Fragments

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- ‚úÖ Fields
- ‚úÖ Operation Name
- ‚úÖ Arguments
- ‚úÖ Aliases
- ‚úÖ Variables
- Directives
- Fragments

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- ‚úÖ Fields
- ‚úÖ Operation Name
- ‚úÖ Arguments
- ‚úÖ Aliases
- ‚úÖ Variables
- ‚úÖ Directives
- Fragments

---

## Our Goal

Do everything [the GraphQL spec](https://graphql.github.io/learn/queries/) can do, but inline

- ‚úÖ Fields
- ‚úÖ Operation Name
- ‚úÖ Arguments
- ‚úÖ Aliases
- ‚úÖ Variables
- ‚úÖ Directives
- ‚úÖ Fragments

---
## Why "Blade" ‚õ∏

"Blade" = inline GraphQL meta-object

---

## Welcome to the Age of AOT

---

![https://ton.twitter.com/1.1/ton/data/dm/1046025045439664137/1046025036711317505/iAcQeccF.jpg:large](https://ton.twitter.com/1.1/ton/data/dm/1046025045439664137/1046025036711317505/iAcQeccF.jpg:large)

---

![https://ton.twitter.com/1.1/ton/data/dm/1046025020986806277/1046025010870136834/uTIvTtlk.jpg:large](https://ton.twitter.com/1.1/ton/data/dm/1046025020986806277/1046025010870136834/uTIvTtlk.jpg:large)

---
## Welcome to the Age of AOT

- React + Prepack
- React + Gatsby/React-Static
- Angular Ivy
- Vue + VuePress
- Svelte + Sapper
- (maybe) **Babel-Macros like Babel-Blade ‚õ∏Ô∏è**

---

## Thank you!

- **Request for Tests**
  - <https://babel-blade.netlify.com/>
- Slides: <https://swyx.io/ReactBoston>
- Twitter: [@swyx](https://twitter.com/swyx)

<div  style={{textAlign:"right"}}>
<small>(further reading in Appendix üëâ)</small>
</div>

---

## Appendix: Must-Watch Talks on Metaprogramming 

- [üì∫ Brendan Eich: Proxies are Awesome!](https://www.youtube.com/watch?v=sClk6aB_CPk)
- [üì∫ Guy Steele: Growing a Language](https://www.youtube.com/watch?v=_ahvzDzKdB0)

---

## Appendix: babel-plugin-macros

- [Intro blogpost](https://babeljs.io/blog/2017/09/11/zero-config-with-babel-macros)
- [List of macros](https://github.com/kentcdodds/babel-plugin-macros/blob/master/other/docs/macros.md)
- [Tutorial](https://blog.kentcdodds.com/write-your-own-code-transform-for-fun-and-profit-140abde9c5c6)
- [ASTExplorer](http://astexplorer.net/#/gist/07b795bf2be92a9926eb76c41dd3e039/28fea15b005d5fd71af5bfe8a9af55e1f52461ea)
- (if writing) [babel-handbook](https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md)
- [create-react-app v2 RFC and PR](https://github.com/facebook/create-react-app/issues/2730)

---

## Appendix: babel-blade

- [babeljs.io repl](https://babeljs.io/repl#?babili=false&browsers=&build=&builtIns=false&spec=false&loose=false&code_lz=FAYw9gdgzgLgBDAprAigV0QJwJ5wLxwiaICGS6W2AFAJTCiSxwDiAogCoD6AIgPLOcACgAle7XvjgBzAI4AbKklQYcdBtHiCAFmBhhJVAN5wARsUQATOAF8a-AHxwqwAJAAeCjjgyV2PIbYuPgERMV5rOAA3EkwASxITOWR_M0RLOAAyDLhjVPTra3tXF0MjOAsyEgAaODkwEgtYiCkbOzxHQ2A4bp6XF3ANOG4AQXZhySUYT2oKmBI6HsWlgaYLMBaCEbGAOjWpYpdYgDMnOoamqTtiGDRMCDg3ABl6xua4AHp7AG4D69v75x9PpuRqRIpA4EASQAtiQpIg4FBMCB_HtdrEoAAHOQkbAwuGICKfA59QxoqBoEx5CxQawktzvUHgvo0H59AquBnTIqs4BAA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=false&presets=react&prettier=false&targets=&version=6.26.0&envVersion=)
- [astexplorer: babel-blade demo](http://astexplorer.net/#/gist/01983f61e310f1eaf6b12a221556a937/a4345dd04f1f7504ef00360f29b2666272765fff)
- Docs: <https://babel-blade.netlify.com/>